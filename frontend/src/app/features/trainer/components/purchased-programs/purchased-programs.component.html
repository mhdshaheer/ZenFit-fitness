<!-- components/trainer-purchased-programs/trainer-purchased-programs.component.html -->
<div class="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto">
    <!-- Page Header -->
    <div class="mb-8">
      <h1 class="text-xl font-bold text-gray-900">Purchased Programs</h1>
      <p class="mt-2 text-sm text-gray-600">
        Track and manage your program purchases
      </p>
    </div>

    <!-- Earnings Summary Cards -->
    <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">
      <!-- Add your summary cards here -->
    </div>

    <!-- Filters Card -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
      <div class="p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Filters</h2>

        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
          <!-- Search Input -->
          <div class="lg:col-span-2">
            <label
              for="search"
              class="block text-sm font-medium text-gray-700 mb-2"
              >
              Search
            </label>
            <input
              id="search"
              type="text"
              [(ngModel)]="filters.search"
              (keyup.enter)="onSearch()"
              placeholder="Search by user or program"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent text-sm transition-shadow"
              />
            </div>

            <!-- Status Filter -->
            <div>
              <label
                for="status"
                class="block text-sm font-medium text-gray-700 mb-2"
                >
                Payment Status
              </label>
              <select
                id="status"
                [(ngModel)]="filters.paymentStatus"
                (change)="onFilterChange()"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent text-sm transition-shadow"
                >
                @for (status of statusOptions; track status) {
                  <option
                    [value]="status.value"
                    >
                    {{ status.label }}
                  </option>
                }
              </select>
            </div>

            <!-- Search Button -->
            <div class="flex items-end">
              <button
                (click)="onSearch()"
                class="w-full px-4 py-2 bg-gray-900 text-white text-sm font-medium rounded-lg hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 transition-colors shadow-sm"
                >
                Search
              </button>
            </div>
          </div>

          <!-- Date Range Filters -->
          <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 mt-4">
            <div>
              <label
                for="startDate"
                class="block text-sm font-medium text-gray-700 mb-2"
                >
                Start Date
              </label>
              <input
                id="startDate"
                type="date"
                [(ngModel)]="filters.startDate"
                (change)="onFilterChange()"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent text-sm transition-shadow"
                />
              </div>
              <div>
                <label
                  for="endDate"
                  class="block text-sm font-medium text-gray-700 mb-2"
                  >
                  End Date
                </label>
                <input
                  id="endDate"
                  type="date"
                  [(ngModel)]="filters.endDate"
                  (change)="onFilterChange()"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent text-sm transition-shadow"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Loading State -->
          @if (loading) {
            <div class="flex justify-center items-center py-20">
              <div class="relative">
                <div
                  class="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"
                ></div>
              </div>
            </div>
          }

          <!-- Desktop Table View -->
          @if (!loading) {
            <div
              class="hidden lg:block bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"
              >
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-900">
                    <tr>
                      <th
                        scope="col"
                        class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider"
                        >
                        Date
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider"
                        >
                        Student
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider"
                        >
                        Program
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider"
                        >
                        Amount
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider"
                        >
                        Your Earning
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider"
                        >
                        Status
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider"
                        >
                        Actions
                      </th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    @for (program of purchasedPrograms; track program) {
                      <tr
                        class="hover:bg-gray-50 transition-colors"
                        >
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          {{ formatDate(program.purchaseDate) }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <div class="text-sm font-medium text-gray-900">
                            {{ program.user.fullName }}
                          </div>
                          <div class="text-sm text-gray-500">
                            {{ program.user.email }}
                          </div>
                        </td>
                        <td class="px-6 py-4">
                          <div class="text-sm font-medium text-gray-900 mb-2">
                            {{ program.program.title }}
                          </div>
                          <div class="flex items-center gap-2">
                            <span
                    [class]="
                      getDifficultyColor(program.program.difficultyLevel)
                    "
                              class="inline-flex text-xs px-2.5 py-1 rounded-full font-medium"
                              >
                              {{ program.program.difficultyLevel }}
                            </span>
                            <span class="text-xs text-gray-500">{{
                              program.program.duration
                            }}</span>
                          </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <div class="text-sm font-semibold text-gray-900">
                            {{ formatCurrency(program.payment.amount) }}
                          </div>
                          <div class="text-xs text-gray-500">
                            Fee: {{ formatCurrency(program.payment.platformFee) }}
                          </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <div class="text-sm font-bold text-gray-900">
                            {{ formatCurrency(program.payment.trainerEarning) }}
                          </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <span
                            [class]="getStatusColor(program.payment.paymentStatus)"
                            class="inline-flex px-3 py-1 text-xs font-semibold rounded-full uppercase"
                            >
                            {{ program.payment.paymentStatus }}
                          </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                          <button
                            (click)="viewDetails(program)"
                            class="text-gray-900 hover:text-gray-700 font-medium transition-colors"
                            >
                            View Details
                          </button>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          }

          <!-- Mobile Card View -->
          @if (!loading) {
            <div class="lg:hidden space-y-4">
              @for (program of purchasedPrograms; track program) {
                <div
                  class="bg-white rounded-lg shadow-sm border border-gray-200 p-5"
                  >
                  <div class="flex items-start justify-between mb-4">
                    <div class="flex-1 min-w-0">
                      <h3 class="text-base font-semibold text-gray-900 truncate">
                        {{ program.user.fullName }}
                      </h3>
                      <p class="text-sm text-gray-500 mt-1 truncate">
                        {{ program.user.email }}
                      </p>
                    </div>
                    <span
                      [class]="getStatusColor(program.payment.paymentStatus)"
                      class="inline-flex px-3 py-1 text-xs font-semibold rounded-full uppercase ml-3 flex-shrink-0"
                      >
                      {{ program.payment.paymentStatus }}
                    </span>
                  </div>
                  <div class="border-t border-gray-200 pt-4 mb-4">
                    <h4 class="text-sm font-semibold text-gray-900 mb-2">
                      {{ program.program.title }}
                    </h4>
                    <div class="flex items-center gap-2 flex-wrap">
                      <span
                        [class]="getDifficultyColor(program.program.difficultyLevel)"
                        class="inline-flex text-xs px-2.5 py-1 rounded-full font-medium"
                        >
                        {{ program.program.difficultyLevel }}
                      </span>
                      <span class="text-xs text-gray-500">{{
                        program.program.duration
                      }}</span>
                    </div>
                  </div>
                  <div class="border-t border-gray-200 pt-4 space-y-3">
                    <div class="flex justify-between items-center text-sm">
                      <span class="text-gray-600">Total Amount:</span>
                      <span class="font-semibold text-gray-900">{{
                        formatCurrency(program.payment.amount)
                      }}</span>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                      <span class="text-gray-600">Your Earning:</span>
                      <span class="font-bold text-gray-900">{{
                        formatCurrency(program.payment.trainerEarning)
                      }}</span>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                      <span class="text-gray-600">Purchase Date:</span>
                      <span class="text-gray-700">{{
                        formatDate(program.purchaseDate)
                      }}</span>
                    </div>
                  </div>
                  <button
                    (click)="viewDetails(program)"
                    class="w-full mt-5 px-4 py-2.5 bg-gray-900 text-white text-sm font-medium rounded-lg hover:bg-gray-800 transition-colors shadow-sm"
                    >
                    View Details
                  </button>
                </div>
              }
            </div>
          }

          <!-- Empty State -->
          @if (!loading && purchasedPrograms.length === 0) {
            <div
              class="bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center"
              >
              <svg
                class="mx-auto h-16 w-16 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
                ></path>
              </svg>
              <h3 class="mt-4 text-lg font-semibold text-gray-900">No sales yet</h3>
              <p class="mt-2 text-sm text-gray-500">
                Your program purchases will appear here
              </p>
            </div>
          }

          <!-- Pagination -->
          @if (!loading && purchasedPrograms.length > 0) {
            <div
              class="mt-6 bg-white rounded-lg shadow-sm border border-gray-200 px-6 py-4"
              >
              <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="text-sm text-gray-700">
                  Showing
                  <span class="font-semibold">{{
                    (pagination.page - 1) * pagination.limit + 1
                  }}</span>
                  to <span class="font-semibold">{{ displayedResultsEnd }}</span> of
                  <span class="font-semibold">{{ pagination.total }}</span> results
                </div>
                <div class="flex gap-2">
                  <button
                    (click)="onPageChange(pagination.page - 1)"
                    [disabled]="pagination.page === 1"
                    [class.opacity-50]="pagination.page === 1"
                    [class.cursor-not-allowed]="pagination.page === 1"
                    class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:hover:bg-white transition-colors"
                    >
                    Previous
                  </button>
                  @for (page of getPaginationArray(); track page) {
                    <button
                      (click)="page !== -1 && onPageChange(page)"
                      [class.bg-gray-900]="page === pagination.page"
                      [class.text-white]="page === pagination.page"
                      [class.border-gray-900]="page === pagination.page"
                      [class.hover:bg-gray-800]="page === pagination.page"
                      [disabled]="page === -1"
                      class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
                      >
                      {{ page === -1 ? "..." : page }}
                    </button>
                  }
                  <button
                    (click)="onPageChange(pagination.page + 1)"
                    [disabled]="pagination.page === pagination.totalPages"
                    [class.opacity-50]="pagination.page === pagination.totalPages"
            [class.cursor-not-allowed]="
              pagination.page === pagination.totalPages
            "
                    class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:hover:bg-white transition-colors"
                    >
                    Next
                  </button>
                </div>
              </div>
            </div>
          }
        </div>
      </div>

      <!-- Details Modal -->
      @if (showDetailsModal && selectedProgram) {
        <div
          class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 backdrop-blur-sm"
          (click)="closeModal()"
          >
          <div
            class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"
            (click)="$event.stopPropagation()"
            >
            <!-- Modal Header -->
            <div
              class="bg-gray-900 px-6 py-5 flex items-center justify-between rounded-t-xl"
              >
              <h3 class="text-xl font-semibold text-white">Sale Details</h3>
              <button
                (click)="closeModal()"
                class="text-gray-300 hover:text-white transition-colors"
                >
                <svg
                  class="h-6 w-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  ></path>
                </svg>
              </button>
            </div>
            <!-- Modal Content -->
            <div class="px-6 py-6 space-y-6">
              <!-- Student Information -->
              <div>
                <h4
                  class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3"
                  >
                  Student Information
                </h4>
                <div class="bg-gray-50 rounded-lg p-4 space-y-2">
                  <p class="text-base font-semibold text-gray-900">
                    {{ selectedProgram.user.fullName }}
                  </p>
                  <p class="text-sm text-gray-600">
                    {{ selectedProgram.user.email }}
                  </p>
                  <p class="text-sm text-gray-600">
                    {{ selectedProgram.user.phone }}
                  </p>
                </div>
              </div>
              <!-- Program Information -->
              <div>
                <h4
                  class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3"
                  >
                  Program Information
                </h4>
                <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                  <p class="text-base font-semibold text-gray-900">
                    {{ selectedProgram.program.title }}
                  </p>
                  <p class="text-sm text-gray-600 leading-relaxed">
                    {{ selectedProgram.program.description }}
                  </p>
                  <div class="flex items-center gap-2 flex-wrap">
                    <span
              [class]="
                getDifficultyColor(selectedProgram.program.difficultyLevel)
              "
                      class="inline-flex text-xs px-2.5 py-1 rounded-full font-medium"
                      >
                      {{ selectedProgram.program.difficultyLevel }}
                    </span>
                    <span
                      class="inline-flex text-xs px-2.5 py-1 bg-gray-200 text-gray-800 rounded-full font-medium"
                      >
                      {{ selectedProgram.program.duration }}
                    </span>
                  </div>
                  <p class="text-sm text-gray-600">
                    Category:
                    <span class="font-semibold">{{
                      selectedProgram.program.category?.name || "N/A"
                    }}</span>
                  </p>
                </div>
              </div>
              <!-- Payment Information -->
              <div>
                <h4
                  class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3"
                  >
                  Payment Information
                </h4>
                <div class="bg-gray-50 rounded-lg p-4">
                  <div class="space-y-3">
                    <div class="flex justify-between items-center">
                      <span class="text-sm text-gray-600">Total Amount:</span>
                      <span class="text-lg font-bold text-gray-900">{{
                        formatCurrency(selectedProgram.payment.amount)
                      }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                      <span class="text-sm text-gray-600">Platform Fee:</span>
                      <span class="text-sm font-semibold text-gray-700">{{
                        formatCurrency(selectedProgram.payment.platformFee)
                      }}</span>
                    </div>
                    <div
                      class="flex justify-between items-center bg-gray-900 text-white -mx-4 px-4 py-3 rounded-lg"
                      >
                      <span class="text-sm font-semibold">Your Earning:</span>
                      <span class="text-lg font-bold">{{
                        formatCurrency(selectedProgram.payment.trainerEarning)
                      }}</span>
                    </div>
                    <div
                      class="border-t border-gray-200 pt-3 flex justify-between items-center"
                      >
                      <span class="text-sm text-gray-600">Payment Status:</span>
                      <span
                        [class]="getStatusColor(selectedProgram.payment.paymentStatus)"
                        class="inline-flex px-3 py-1 text-xs font-semibold rounded-full uppercase"
                        >
                        {{ selectedProgram.payment.paymentStatus }}
                      </span>
                    </div>
                    <div class="flex justify-between items-center">
                      <span class="text-sm text-gray-600">Payment Method:</span>
                      <span class="text-sm font-semibold text-gray-700 uppercase">{{
                        selectedProgram.payment.paymentMethod
                      }}</span>
                    </div>
                    <div class="flex justify-between items-start">
                      <span class="text-sm text-gray-600">Transaction ID:</span>
                      <span
                        class="text-xs font-mono text-gray-700 text-right break-all max-w-xs"
                        >{{ selectedProgram.payment.chargeId || "N/A" }}</span
                        >
                      </div>
                      <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Purchase Date:</span>
                        <span class="text-sm font-semibold text-gray-700">{{
                          formatDate(selectedProgram.purchaseDate)
                        }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Action Button -->
                <div class="pt-2">
                  <button
                    (click)="closeModal()"
                    class="w-full px-4 py-3 bg-gray-900 text-white text-sm font-semibold rounded-lg hover:bg-gray-800 transition-colors shadow-sm"
                    >
                    Close
                  </button>
                </div>
              </div>
            </div>
          </div>
        }
