<!-- Modern Trainer Purchased Programs Page -->
<div class="purchased-programs-container">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">Sales Dashboard</h1>
      <p class="page-subtitle">
        Track your program sales, earnings, and student purchases
      </p>
    </div>

    <!-- Earnings Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card">
        <div class="summary-card-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success);">
          <i class="fas fa-dollar-sign"></i>
        </div>
        <h3 class="summary-card-value">{{ formatCurrency(getTotalEarnings()) }}</h3>
        <p class="summary-card-label">Total Earnings</p>
      </div>
      
      <div class="summary-card">
        <div class="summary-card-icon" style="background: rgba(59, 130, 246, 0.1); color: var(--info);">
          <i class="fas fa-shopping-cart"></i>
        </div>
        <h3 class="summary-card-value">{{ getTotalSales() }}</h3>
        <p class="summary-card-label">Total Sales</p>
      </div>
      
      <div class="summary-card">
        <div class="summary-card-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--warning);">
          <i class="fas fa-clock"></i>
        </div>
        <h3 class="summary-card-value">{{ getPendingPayments() }}</h3>
        <p class="summary-card-label">Pending Payments</p>
      </div>
      
      <div class="summary-card">
        <div class="summary-card-icon" style="background: rgba(66, 71, 88, 0.1); color: var(--primary-color);">
          <i class="fas fa-users"></i>
        </div>
        <h3 class="summary-card-value">{{ getUniqueStudents() }}</h3>
        <p class="summary-card-label">Unique Students</p>
      </div>
    </div>

    <!-- Filters Card -->
    <div class="filters-card">
      <div class="filters-header">
        <h2>Search & Filter</h2>
      </div>
      <div class="filters-content">
        <div class="filters-grid">
          <!-- Search Input -->
          <div class="form-group">
            <label for="search" class="form-label">Search</label>
            <input
              id="search"
              type="text"
              [(ngModel)]="filters.search"
              (input)="onRealTimeSearch()"
              placeholder="Search by user or program"
              class="form-input"
            />
          </div>

          <!-- Status Filter -->
          <div class="form-group">
            <label for="status" class="form-label">Payment Status</label>
            <select
              id="status"
              [(ngModel)]="filters.paymentStatus"
              (change)="onRealTimeSearch()"
              class="form-select"
            >
              @for (status of statusOptions; track status) {
                <option [value]="status.value">
                  {{ status.label }}
                </option>
              }
            </select>
          </div>

          <!-- Start Date -->
          <div class="form-group">
            <label for="startDate" class="form-label">Start Date</label>
            <input
              id="startDate"
              type="date"
              [(ngModel)]="filters.startDate"
              (change)="onRealTimeSearch()"
              class="form-input"
            />
          </div>

          <!-- End Date -->
          <div class="form-group">
            <label for="endDate" class="form-label">End Date</label>
            <input
              id="endDate"
              type="date"
              [(ngModel)]="filters.endDate"
              (change)="onRealTimeSearch()"
              class="form-input"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    @if (loading) {
      <div class="loading-container">
        <div class="loading-spinner"></div>
      </div>
    }

    <!-- View Tabs -->
    @if (!loading) {
      <div class="view-tabs-container">
        <div class="view-tabs">
          <button 
            (click)="setActiveView('table')" 
            [class.active]="activeView === 'table'"
            class="tab-button">
            <i class="fas fa-table mr-2"></i>
            Table View
          </button>
          <button 
            (click)="setActiveView('cards')" 
            [class.active]="activeView === 'cards'"
            class="tab-button">
            <i class="fas fa-th-large mr-2"></i>
            Card View
          </button>
        </div>
      </div>

      <!-- Table View Tab Content -->
      @if (activeView === 'table') {
        <div class="table-card">
          <div class="table-container">
            <table class="data-table">
              <thead class="table-header">
                <tr>
                  <th>Date</th>
                  <th>Student</th>
                  <th>Program</th>
                  <th>Amount</th>
                  <th>Your Earning</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                @for (program of purchasedPrograms; track program) {
                  <tr class="table-row">
                    <td class="table-cell">
                      {{ formatDate(program.purchaseDate) }}
                    </td>
                    <td class="table-cell">
                      <div class="text-sm font-medium text-gray-900">
                        {{ program.user.fullName }}
                      </div>
                      <div class="text-sm text-gray-500">
                        {{ program.user.email }}
                      </div>
                    </td>
                    <td class="table-cell">
                      <div class="text-sm font-medium text-gray-900 mb-2">
                        {{ program.program.title }}
                      </div>
                      <div class="flex items-center gap-2">
                        <span
                          [class]="getDifficultyColor(program.program.difficultyLevel)"
                          class="difficulty-badge"
                        >
                          {{ program.program.difficultyLevel }}
                        </span>
                        <span class="text-xs text-gray-500">{{
                          program.program.duration
                        }}</span>
                      </div>
                    </td>
                    <td class="table-cell">
                      <div class="text-sm font-semibold text-gray-900">
                        {{ formatCurrency(program.payment.amount) }}
                      </div>
                      <div class="text-xs text-gray-500">
                        Fee: {{ formatCurrency(program.payment.platformFee) }}
                      </div>
                    </td>
                    <td class="table-cell">
                      <div class="text-sm font-bold text-gray-900">
                        {{ formatCurrency(program.payment.trainerEarning) }}
                      </div>
                    </td>
                    <td class="table-cell">
                      <span
                        [class]="getStatusColor(program.payment.paymentStatus)"
                        class="status-badge"
                      >
                        {{ program.payment.paymentStatus }}
                      </span>
                    </td>
                    <td class="table-cell">
                      <button
                        (click)="viewDetails(program)"
                        class="text-gray-900 hover:text-gray-700 font-medium transition-colors"
                      >
                        View Details
                      </button>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      }

      <!-- Card View Tab Content -->
      @if (activeView === 'cards') {
        <div class="mobile-cards">
          @for (program of purchasedPrograms; track program) {
            <div class="mobile-card">
              <div class="flex items-start justify-between mb-4">
                <div class="flex-1 min-w-0">
                  <h3 class="text-base font-semibold text-gray-900 truncate">
                    {{ program.user.fullName }}
                  </h3>
                  <p class="text-sm text-gray-500 mt-1 truncate">
                    {{ program.user.email }}
                  </p>
                </div>
                <span
                  [class]="getStatusColor(program.payment.paymentStatus)"
                  class="status-badge ml-3 flex-shrink-0"
                >
                  {{ program.payment.paymentStatus }}
                </span>
              </div>
              <div class="border-t border-gray-200 pt-4 mb-4">
                <h4 class="text-sm font-semibold text-gray-900 mb-2">
                  {{ program.program.title }}
                </h4>
                <div class="flex items-center gap-2 flex-wrap">
                  <span
                    [class]="getDifficultyColor(program.program.difficultyLevel)"
                    class="difficulty-badge"
                  >
                    {{ program.program.difficultyLevel }}
                  </span>
                  <span class="text-xs text-gray-500">{{
                    program.program.duration
                  }}</span>
                </div>
              </div>
              <div class="border-t border-gray-200 pt-4 space-y-3">
                <div class="flex justify-between items-center text-sm">
                  <span class="text-gray-600">Total Amount:</span>
                  <span class="font-semibold text-gray-900">{{
                    formatCurrency(program.payment.amount)
                  }}</span>
                </div>
                <div class="flex justify-between items-center text-sm">
                  <span class="text-gray-600">Your Earning:</span>
                  <span class="font-bold text-gray-900">{{
                    formatCurrency(program.payment.trainerEarning)
                  }}</span>
                </div>
                <div class="flex justify-between items-center text-sm">
                  <span class="text-gray-600">Purchase Date:</span>
                  <span class="text-gray-700">{{
                    formatDate(program.purchaseDate)
                  }}</span>
                </div>
              </div>
              <button
                (click)="viewDetails(program)"
                class="view-details-button"
              >
                View Details
              </button>
            </div>
          }
        </div>
      }
    }

    <!-- Empty State -->
    @if (!loading && purchasedPrograms.length === 0) {
      <div class="empty-state">
        <svg
          class="empty-icon"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
          ></path>
        </svg>
        <h3 class="empty-title">No sales yet</h3>
        <p class="empty-message">
          Your program purchases will appear here
        </p>
      </div>
    }

    <!-- Pagination -->
    @if (!loading && purchasedPrograms.length > 0) {
      <div class="pagination-card">
        <div class="pagination-container">
          <div class="pagination-info">
            Showing
            <span class="font-semibold">{{
              (pagination.page - 1) * pagination.limit + 1
            }}</span>
            to <span class="font-semibold">{{ displayedResultsEnd }}</span> of
            <span class="font-semibold">{{ pagination.total }}</span> results
          </div>
          <div class="pagination-buttons">
            <button
              (click)="onPageChange(pagination.page - 1)"
              [disabled]="pagination.page === 1"
              class="pagination-button"
              >
              Previous
            </button>
            @for (page of getPaginationArray(); track page) {
              <button
                (click)="page !== -1 && onPageChange(page)"
                [class.active]="page === pagination.page"
                [disabled]="page === -1"
                class="pagination-button"
                >
                {{ page === -1 ? "..." : page }}
              </button>
            }
            <button
              (click)="onPageChange(pagination.page + 1)"
              [disabled]="pagination.page === pagination.totalPages"
              class="pagination-button"
              >
              Next
            </button>
          </div>
        </div>
      </div>
    }

    <!-- Details Modal -->
    @if (showDetailsModal && selectedProgram) {
      <div
        class="modal-overlay"
        (click)="closeModal()"
        >
        <div
          class="modal-content"
          (click)="$event.stopPropagation()"
          >
            <!-- Modal Header -->
            <div class="modal-header">
              <h3 class="modal-title">Sale Details</h3>
              <button
                (click)="closeModal()"
                class="modal-close"
                >
                <svg
                  class="h-6 w-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  ></path>
                </svg>
              </button>
            </div>
            <!-- Modal Content -->
            <div class="px-6 py-6 space-y-6">
              <!-- Student Information -->
              <div>
                <h4
                  class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3"
                  >
                  Student Information
                </h4>
                <div class="bg-gray-50 rounded-lg p-4 space-y-2">
                  <p class="text-base font-semibold text-gray-900">
                    {{ selectedProgram.user.fullName }}
                  </p>
                  <p class="text-sm text-gray-600">
                    {{ selectedProgram.user.email }}
                  </p>
                  <p class="text-sm text-gray-600">
                    {{ selectedProgram.user.phone }}
                  </p>
                </div>
              </div>
              <!-- Program Information -->
              <div>
                <h4
                  class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3"
                  >
                  Program Information
                </h4>
                <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                  <p class="text-base font-semibold text-gray-900">
                    {{ selectedProgram.program.title }}
                  </p>
                  <p class="text-sm text-gray-600 leading-relaxed">
                    {{ selectedProgram.program.description }}
                  </p>
                  <div class="flex items-center gap-2 flex-wrap">
                    <span
              [class]="
                getDifficultyColor(selectedProgram.program.difficultyLevel)
              "
                      class="inline-flex text-xs px-2.5 py-1 rounded-full font-medium"
                      >
                      {{ selectedProgram.program.difficultyLevel }}
                    </span>
                    <span
                      class="inline-flex text-xs px-2.5 py-1 bg-gray-200 text-gray-800 rounded-full font-medium"
                      >
                      {{ selectedProgram.program.duration }}
                    </span>
                  </div>
                  <p class="text-sm text-gray-600">
                    Category:
                    <span class="font-semibold">{{
                      selectedProgram.program.category?.name || "N/A"
                    }}</span>
                  </p>
                </div>
              </div>
              <!-- Payment Information -->
              <div>
                <h4
                  class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3"
                  >
                  Payment Information
                </h4>
                <div class="bg-gray-50 rounded-lg p-4">
                  <div class="space-y-3">
                    <div class="flex justify-between items-center">
                      <span class="text-sm text-gray-600">Total Amount:</span>
                      <span class="text-lg font-bold text-gray-900">{{
                        formatCurrency(selectedProgram.payment.amount)
                      }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                      <span class="text-sm text-gray-600">Platform Fee:</span>
                      <span class="text-sm font-semibold text-gray-700">{{
                        formatCurrency(selectedProgram.payment.platformFee)
                      }}</span>
                    </div>
                    <div
                      class="flex justify-between items-center bg-gray-900 text-white -mx-4 px-4 py-3 rounded-lg"
                      >
                      <span class="text-sm font-semibold">Your Earning:</span>
                      <span class="text-lg font-bold">{{
                        formatCurrency(selectedProgram.payment.trainerEarning)
                      }}</span>
                    </div>
                    <div
                      class="border-t border-gray-200 pt-3 flex justify-between items-center"
                      >
                      <span class="text-sm text-gray-600">Payment Status:</span>
                      <span
                        [class]="getStatusColor(selectedProgram.payment.paymentStatus)"
                        class="inline-flex px-3 py-1 text-xs font-semibold rounded-full uppercase"
                        >
                        {{ selectedProgram.payment.paymentStatus }}
                      </span>
                    </div>
                    <div class="flex justify-between items-center">
                      <span class="text-sm text-gray-600">Payment Method:</span>
                      <span class="text-sm font-semibold text-gray-700 uppercase">{{
                        selectedProgram.payment.paymentMethod
                      }}</span>
                    </div>
                    <div class="flex justify-between items-start">
                      <span class="text-sm text-gray-600">Transaction ID:</span>
                      <span
                        class="text-xs font-mono text-gray-700 text-right break-all max-w-xs"
                        >{{ selectedProgram.payment.chargeId || "N/A" }}</span
                        >
                      </div>
                      <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Purchase Date:</span>
                        <span class="text-sm font-semibold text-gray-700">{{
                          formatDate(selectedProgram.purchaseDate)
                        }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Action Button -->
                <div class="pt-2">
                  <button
                    (click)="closeModal()"
                    class="w-full px-4 py-3 bg-gray-900 text-white text-sm font-semibold rounded-lg hover:bg-gray-800 transition-colors shadow-sm"
                    >
                    Close
                  </button>
                </div>
              </div>
            </div>
          </div>
        }
  </div>
</div>
