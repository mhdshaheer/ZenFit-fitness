<div class="table-card">
  <div class="table-card__filters">
    <div class="search-field">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M21 21l-4.35-4.35M17 10a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
      <input type="text" [(ngModel)]="searchTerm" (input)="onSearch($event)"
        placeholder="Search {{ entityName.toLowerCase() }}" />
    </div>
    <div class="table-card__meta">
      <span class="meta-dot"></span>
      <span>{{ totalItems }} total</span>
    </div>
  </div>

  <div class="table-card__table-wrapper">
    <table class="zf-table">
      <thead>
        <tr>
          @for (column of columns; track column) {
          <th [style.width]="column.width">
            <button type="button" class="zf-table__sort-btn" [class.sortable]="column.sortable"
              (click)="column.sortable ? onSort(column.key) : null">
              <span>{{ column.label }}</span>
              @if (column.sortable) {
              <span class="sort-indicator">
                <svg viewBox="0 0 20 20" [class.active]="sortColumn === column.key && sortDirection === 'asc'">
                  <path
                    d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z">
                  </path>
                </svg>
                <svg viewBox="0 0 20 20" [class.active]="sortColumn === column.key && sortDirection === 'desc'">
                  <path
                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z">
                  </path>
                </svg>
              </span>
              }
            </button>
          </th>
          }
          <th class="cell--right">Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (row of data; track row; let i = $index) {
        <tr>
          @for (column of columns; track column) {
          <td [ngClass]="getCellClass(column.type)">
            <div>
              @switch (column.type) {
              @case ('avatar') {
              <div class="avatar-cell">
                <div class="avatar">
                  @if (row[column.key]) {
                  <img [src]="row[column.key]" [alt]="row.name || row.email" />
                  } @else {
                  <span>{{ row.name?.charAt(0) || '?' }}</span>
                  }
                </div>
                <div>
                  <p class="avatar__name">
                    {{ row.name || row.firstName + " " + row.lastName }}
                  </p>
                  <p class="avatar__meta">{{ row.email }}</p>
                </div>
              </div>
              }
              @case ('status') {
              <span class="status-pill" [ngClass]="getStatusClass(row[column.key])">
                {{ row[column.key] }}
              </span>
              }
              @case ('date') {
              <span class="date-text">{{ formatDate(row[column.key]) }}</span>
              }
              @case ('email') {
              <a [href]="'mailto:' + row[column.key]" class="email-link">
                {{ row[column.key] }}
              </a>
              }
              @case ('approval') {
              <span class="approval-chip" [ngClass]="getApprovalClass(row.approvalStatus)">
                {{ row.approvalStatus }}
              </span>
              }
              @default {
              <span>{{ row[column.key] }}</span>
              }
              }
            </div>
          </td>
          }
          <td class="cell--right">
            <div class="action-row">
              @for (action of getAvailableActions(row); track action) {
              <button (click)="onAction(action.action, row, i)" [title]="action.label" class="action-row__btn"
                [ngClass]="getActionClass(action.color)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    [attr.d]="getActionIcon(action.icon)"></path>
                </svg>
              </button>
              }
            </div>
          </td>
        </tr>
        }

        @if (data.length === 0) {
        <tr>
          <td [attr.colspan]="columns.length + 1">
            <div class="empty-state">
              <div class="empty-state__icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5"></path>
                </svg>
              </div>
              <p>No {{ entityName.toLowerCase() }}s found</p>
              <small>Try refining your search or filters</small>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <div class="table-card__pagination">
    <div class="summary">
      Showing {{ startIndex + 1 }}-
      {{ Math.min(startIndex + pageSize, totalItems) }} of {{ totalItems }}
      results
    </div>
    <div class="pager">
      <button type="button" class="pager__btn" (click)="previousPage()" [disabled]="currentPage == 1">
        Previous
      </button>
      <span class="pager__page active">{{ currentPage }}</span>
      <button type="button" class="pager__btn" (click)="nextPage()" [disabled]="currentPage == totalPages">
        Next
      </button>
    </div>
  </div>
</div>